# 功能：一个用户A给一个用户B发消息，但是要保证这个消息的内容只能被A和B知道。其他无论你是谁都没办法破解或者篡改消息的内容。

https://zhuanlan.zhihu.com/p/25976060

![img](https://pic4.zhimg.com/80/v2-fab22c5667370f492dd696fb65dae5eb_720w.png)

## 第一层：安全传输数据

1.由于消息不想被其他人看到----->想到 **消息加密**，并且只有A和B才有解密的密钥

结合上面描述，这里需要考虑两点：

- 使用什么加密方式？
- 密钥怎么告知对方？

### 针对问题一：使用什么加密方式？

加密算法分为两类：

1. 对称加密：两边用同一个密钥来加密和解密
2. 非对称加密：两方使用不同的密钥来加密和解密

### 针对问题二：密钥怎么告知对方？*这是导致整个https通信过程很复杂的根本原因* 。如果A或B直接把他们之间用于解密的密钥通过互联网传输给对方，那一旦密钥被第三者劫持，第三者就能正确解密A,B之间的通信数据。

## 第二层：安全传输密钥

![img](https://pic3.zhimg.com/80/v2-5325c835d2c8f599772b76536b0e626a_720w.png)



因为如果传输过程中这把密钥被第三者拿到了，就能解密传通信数据

所以，***这把密钥必须得加密***。就算第三者劫持到这把加密过的密钥，他也不能解密，得到真正的密钥。

那么用什么方法加密这把密钥呢？

如果用对称加密就会陷入死循环 https://www.bilibili.com/video/BV1q7411E7oa?from=search&seid=8809898301026014150（一个小孩子讲加密的视频，逻辑到位）

### 那使用非对称加密呢？

- **接收方B事先会准备好一个公开密钥和私有密钥，B把公有密钥发给A，公有密钥可能会被窃听到**。
- **然后 A： 明文 + 公开密钥 = 密文。A把密文发给B。 *密文可能会被窃听到*。**（也就是说黑客可能同时窃听到公有密钥和密文，但是公开密钥只能加密不能解密，所以黑客无法获得明文）
- **然后B：用事先准备好的私有密钥 + 密文 = 明文。**
  - （B生成的私有密钥必须要保管好，不能把它传输到网上，不然黑客就可以解密了。而公有密钥就算泄露也无妨）
  - （不能通过一个密钥算出另一个密钥，黑客知道公开密钥他无法算出私有密钥）
  - （非对称加密只能一个密钥加密，另一个密钥解密。如果用公钥加密，用私钥解密，得到的就是密文；如果是用私钥加密，公钥解密，那就是数字签名了？？？）
- 上面的流程依旧有漏洞！！！
- **黑客为了窃听A给B发送的信息，提前准备了自己的公开密钥XP和私有密钥XS**
- **A给B发送信息前，B得把公开密钥传给A，当B把公开密钥发到网上时，X窃听到公开密钥并用它的公开密钥XP替换，发送给A，A根本不知道这已经是被X给替换过的公开密钥**
- **A用黑客的公开密钥XP给明文加密，然后发送密文**
- **黑客截获密文，并用自己的私有密钥XS解密获得明文**
- **黑客的窃听完成了，接着它不能让B知道信息已经被窃听了**
- **黑客用窃听到的公开密钥和解密得到的明文，加密得到密文（就像是A在加密一样），发给B**

### 改进：使用混合加密

- 传送大量数据的时候一定要用对称加密，因为它的速度快，但是由于对称加密有密钥分配问题

- 所有用非对称加密来加密这个密钥，然后再传给对方。
- <img src="../../../Library/Application%20Support/typora-user-images/image-20201116111946310.png" alt="image-20201116111946310" style="zoom: 45%;" />

不过上图依旧存在黑客提前准备自己的公开密钥XP和私有密钥XS来进行攻击的问题。

怎么预防呢？

**用到数字证书里面的数字签名**

消息认证码和数字签名如何生成呢？

### 先来认识一下哈希函数

xxx

#### 哈希函数有什么用呢？

​		防止网站密码泄露

​		首选网站应该会知道你的密码，然后对正确密码做一次哈希，得到正确密码的哈希值，把哈希值保存下来，下次再输入密码的时候，服务器会对你输入的密码再进行一次哈希，得到你输入密码的哈希值，如果和正确密码的哈希值一致的话，就说明密码输对了

#### 为什么要使用哈希值呢？直接保存密码为什么不行呢？ 

​		那是因为服务器为了记下每个人登这个网站的密码，他们可能会列成一张表，写着用户名和密码，不过如果这张表泄露了该怎么办？所以要使用哈希函数把它变成哈希值。

#### 消息认证码到底是如何生成的？https://www.bilibili.com/video/BV1C7411L7UZ/?spm_id_from=trigger_reload （有点难懂 需要在看一遍）

- 消息认证码使用的是对称加密
- Data-Encryption-Key 数据加密密钥
- Encrypted-Data 加密的数据

![image-20201116154755107](../../../Library/Application%20Support/typora-user-images/image-20201116154755107.png)

#### 数字签名/防事后否认/中间人攻击：https://www.bilibili.com/video/BV1KE41177kK（看不下去了，明天继续啃）

数字签名（和非对称加密是反的）的流程：











###  



