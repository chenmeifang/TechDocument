https://www.bilibili.com/video/BV1ev411P7jn/?spm_id_from=333.337.search-card.all.click&vd_source=a7089a0e007e4167b4a61ef53acc6f7e

  "react-dom": "^18.2.0",

  "react-dom": "^17.0.1",

https://www.bilibili.com/video/BV13j411D7K6/?spm_id_from=333.788.recommend_more_video.11&vd_source=a7089a0e007e4167b4a61ef53acc6f7e

# 1.配置React源码本地调试环境

注意：

![image-20240307202439100](源码.assets/image-20240307202439100.png)

1.使用create-react-app脚手架创建项目

​	`npx create-react-app react-test`

2.弹射create-react-app

​	`npm run eject`

3.克隆react官方源码

​	`git clone --branch v16.13.1 --depth=1 https://github.com/facebook/react.git src/react`

4.链接本地源码

```javascript
// 文件位置：react-test/config/webpack.config.js
resolve: {
      alias: {
        'react-native': 'react-native-web',                
        "react": path.resolve(__dirname, "../src/react/packages/react"),
        "react-dom": path.resolve(__dirname, "../src/react/packages/react-dom"),
        "shared": path.resolve(__dirname, "../src/react/packages/shared"),
        "react-reconciler": path.resolve(__dirname, "../src/react/packages/react-reconciler"),
        "legacy-events": path.resolve(__dirname, "../src/react/packages/legacy-events"),
      }
}
```

==问题：path.resolve(__dirname，‘xxx’)不熟==

5.修改环境变量

```javascript
// 文件位置：react-test/config/env.js
const stringified = {
    'process.env': Object.keys(raw).reduce((env, key) => {
      env[key] = JSON.stringify(raw[key]);
      return env;
    }, {}),
    __DEV__: true,
    SharedArrayBuffer: true,
    spyOnDev: true,
    spyOnDevAndProd: true,
    spyOnProd: true,
    __PROFILE__: true,
    __UMD__: true,
    __EXPERIMENTAL__: true,
    __VALIANT__: true,
    gate: true,
    trustedTypes: true
};
```

6.告诉babel在转换代码时忽略类型检查

`npm install @babel/plugin-transform-flow-strip-types -D`

```javascript
// 文件位置：react-test/config/webpack.config.js [babel-loader]
plugins: [
    require.resolve("@babel/plugin-transform-flow-strip-types"),
]
```

7.导出HostConfig

```javascript
// 文件位置: react\packages\react-reconciler\src\ReactFiberHostConfig.js
+ export * from './forks/ReactFiberHostConfig.dom';
```

![image-20240306211106420](源码.assets/image-20240306211106420.png)

8.修改ReactSharedInternals.js文件

```javascript
// 文件位置：react\packages\shared\ReactSharedInternals.js
- import * as React from 'react';
- const ReactSharedInternals = React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;
+ import ReactSharedInternals from '../react/src/ReactSharedInternals';
```

9.关闭eslint扩展

![image-20240306203849889](源码.assets/image-20240306203849889.png)

10.禁止invariant报错

```javascript
if (condition) return;
```

![image-20240306203950405](源码.assets/image-20240306203950405.png)

11.eslint配置

在react源码文件夹中新建.eslintrc.json并添加如下配置

```javascript
{
    "extends": "react-app",
    "globals": {
        "SharedArrayBuffer": true,
        "spyOnDev": true,
        "spyOnDevAndProd": true,
        "spyOnProd": true,
        "__PROFILE__": true,
        "__UMD__": true,
        "__EXPERIMENTAL__": true,
        "__VALIANT__": true,
        "gate": true,
        "trustedTypes": true
    }
}
```

12.修改react react-dom引入方式

![image-20240306204242420](源码.assets/image-20240306204242420.png)

13.解决vsCode中flow报错

![image-20240306204408448](源码.assets/image-20240306204408448.png)

14.可选项配置

![image-20240306204701035](源码.assets/image-20240306204701035.png)

15.____DEV____报错

删除node_modules，执行npm Install





