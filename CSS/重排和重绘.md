网页生成过程：

1. HTML被HTML解析器解析成DOM 树
2. css则被css解析器解析成CSSOM 树
3. 结合DOM树和CSSOM树，生成一棵渲染树(Render Tree)
4. 生成布局（flow），即将所有渲染树的所有节点进行平面合成
5. 将布局绘制（paint）在屏幕上

第四步和第五步是最耗时的部分，这两步合起来，就是我们通常所说的渲染

==重绘==：某些元素的外观被改变，例如：元素的填充颜色

==重排==：重新生成布局，重新排列元素。



触发重排的条件：任何页面布局和几何属性的改变都会触发重排，比如：

1、页面渲染初始化；(无法避免)

2、添加或删除可见的DOM元素；

3、元素位置的改变，或者使用动画；

4、元素尺寸的改变——大小，外边距，边框；

5、浏览器窗口尺寸的变化（resize事件发生时）；

6、填充内容的改变，比如文本的改变或图片大小改变而引起的计算值宽度和高度的改变；

7、读取某些元素属性：（offsetLeft/Top/Height/Width,　clientTop/Left/Width/Height,　scrollTop/Left/Width/Height,　width/height,　getComputedStyle(),　currentStyle(IE)　)？？？

当获取布局信息操作的时候，会**强制**浏览器**提前flush队列**，触发回流重绘返回信息，这种情况下，浏览器的优化就不起作用了。比如以下属性或方法：

- offsetTop、offsetLeft、offsetWidth、offsetHeight  https://blog.csdn.net/jinxi1112/article/details/90692484
- scrollTop、scrollLeft、scrollWidth、scrollHeight https://blog.csdn.net/gang_gang_gang/article/details/4233044
- clientTop、clientLeft、clientWidth、clientHeight 
- getComputedStyle()
- getBoundingClientRect



优化：

1、浏览器自己的优化：浏览器会维护1个队列，把所有会引起回流、重绘的操作放入这个队列，等队列中的操作到了一定的数量或者到了一定的时间间隔，浏览器就会flush队列，进行一个批处理。这样就会让多次的回流、重绘变成一次回流重绘。

2、我们要注意的优化：我们要减少重绘和重排就是要减少对渲染树的操作，则我们可以合并多次的DOM和样式的修改。并减少对style样式的请求。

（1）直接改变元素的className？？？？？不要一条一条地修改 DOM 的样式。可以先定义好 css 的 class，然后修改 DOM 的 className。

（2）display：none；先设置元素为display：none；然后进行页面布局等操作；设置完成后将元素设置为display：block；这样的话就只引发两次重绘和重排；！！！

（3）使用cloneNode(true or false) 和 replaceChild 技术，引发一次回流和重绘；

（4）将需要多次重排的元素，position属性设为absolute或fixed，元素脱离了文档流，它的变化不会影响到其他元素；

（5）如果需要创建多个DOM节点，可以使用**DocumentFragment**创建完后一次性的加入document；

domParent为已渲染节点

let child1 = document.createElement('div');

let child2 = document.createElement('div');

domParent.appendChild(child1);

child1.appendChild(child2);

上述会导致浏览器重新渲染两次

let child1 = document.createElement('div');

let child2 = document.createElement('div');

child1.appendChild(child2);

domParent.appendChild(child1);

在child1还没渲染到页面上，把child2加进去，只会渲染一次



![重排](/Users/chenmeifang/Desktop/typora/图片/重排.png)

fontsize改变会引起重排吗？会

Outline改变会引起重排吗？https://www.pianshen.com/article/97421888871/ 为什么outline-width不会引起回流而border-width会引起？

* 轮廓（outline）是绘制于元素周围的一条线，位于边框边缘的外围，可起到突出元素的作用
* 在浏览器里，当鼠标点击或使用Tab键让一个链接或者一个radio获得焦点的时候，该元素将会被一个轮廓虚线框围绕。这个轮廓虚线框就是 outline
* border 可应用于几乎所有有形的 html 元素，而 outline 是针对链接、表单控件和 ImageMap 等元素设计
* outline 的效果将随元素的 focus 而自动出现，相应的由 blur 而自动消失。这些都是浏览器的默认行为，无需 JavaScript 配合 CSS 来控制
* outline 是不占空间的，不会像 border 那样影响元素的尺寸或者位置，既不会增加额外的 width 或者 height





















