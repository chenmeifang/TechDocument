(()=>{"use strict";var e,t={3742:(e,t,n)=>{var r=n(9471),o=n(2866),i=n(2820),l=n(8219);function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,l,a=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(u)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const u=function(){var e=a((0,r.useState)(""),2),t=e[0],n=e[1],o=a((0,r.useState)(""),2),c=o[0],u=o[1],s=(0,i.W6)();return r.createElement(r.Fragment,null,r.createElement("div",null,"登录页面"),r.createElement("label",null,"用户名："),r.createElement("input",{type:"text",value:t,onChange:function(e){n(e.target.value)}}),r.createElement("br",null),r.createElement("label",null,"密码："),r.createElement("input",{type:"password",value:c,onChange:function(e){u(e.target.value)}}),r.createElement("br",null),r.createElement("button",{onClick:function(){l.http.post("/users/login",{username:t,pwd:c}).then((function(e){if(console.log(e),200==e.data.code){var t=e.data.token;document.cookie="".concat(t),s.replace("/fileList")}else alert("Invalid credentials")})).catch((function(e){console.log(e)}))}},"登录"))};var s=n(9030),d=n(7984),f=n.n(d),p=n(3085),g=n(8094),h=n(579),v=n(5047),m=n(5072),y=n.n(m),b=n(7825),A=n.n(b),x=n(7659),M=n.n(x),E=n(5056),w=n.n(E),j=n(540),O=n.n(j),C=n(1113),k=n.n(C),S=n(8995),_={};function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}_.styleTagTransform=k(),_.setAttributes=w(),_.insert=M().bind(null,"head"),_.domAPI=A(),_.insertStyleElement=O(),y()(S.A,_),S.A&&S.A.locals&&S.A.locals;const P=function(){var e,t,n,o=(0,r.useRef)(null),i=(t=(0,r.useState)([]),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,l,a=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(u)throw o}}return a}}(t,n)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=(i[0],i[1],(null==o||null===(e=o.current)||void 0===e?void 0:e.innerHTML)||""),a=new(f());(0,r.useEffect)((function(){p.default.on("connect",(function(){console.log("client connect",p.default.id)})),p.default.on("edit",(function(e){o.current.innerHTML=(0,h.receiveMessage)(e[0],o.current.innerHTML)}))}));var c=function(e){var t=0;console.log("caretOffset:",t);var n=e.target.ownerDocument.defaultView.getSelection();return n.rangeCount&&(n.getRangeAt(0),t=n.focusOffset),t};return r.createElement("div",null,"查看文件",r.createElement("button",{onClick:function(){o.current.innerHTML=(0,v.undo)(o.current.innerHTML)}},"undo"),r.createElement("div",{contentEditable:!0,onInput:function(e){console.log("编辑了，需要发消息出去:",e.target.innerHTML);var t=a.diff_main(l,e.target.innerHTML);l=e.target.innerHTML;var n=(0,g.createInsertTextActPair)(c(e)-1,1,t[t.length-1][1]),r={msg:n.act,rMsg:n.rAct};(0,g.sendMsg)([r])},className:"editor",ref:o,onMouseUp:c}))},B=function(){return r.createElement(o.BrowserRouter,null,r.createElement(i.qh,{path:"/login",component:u}),r.createElement(i.qh,{path:"/fileList",component:s.A}),r.createElement(i.qh,{path:"/fileEdit",component:P}))};n(4723).createRoot(document.getElementById("root")).render(r.createElement(B,null))},8995:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(963),o=n.n(r),i=n(9089),l=n.n(i)()(o());l.push([e.id,"/* 需要在webpack中配置css相关的loader */\n.editor {\n  border: 1px solid red;\n  padding: 10px;\n  height: 400px;\n  width: 400px;\n  /* min-height: 200px; */\n  margin-top: 10px;\n}\n","",{version:3,sources:["webpack://./src/pages/FileEdit/index.css"],names:[],mappings:"AAAA,8BAA8B;AAC9B;EACE,qBAAqB;EACrB,aAAa;EACb,aAAa;EACb,YAAY;EACZ,uBAAuB;EACvB,gBAAgB;AAClB",sourcesContent:["/* 需要在webpack中配置css相关的loader */\r\n.editor {\r\n  border: 1px solid red;\r\n  padding: 10px;\r\n  height: 400px;\r\n  width: 400px;\r\n  /* min-height: 200px; */\r\n  margin-top: 10px;\r\n}\r\n"],sourceRoot:""}]);const a=l},8094:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createInsertTextActPair=t.sendMsg=t.sendOutMsgWithoutDealUndoRedo=void 0;var o=r(n(3085)),i=n(5047),l={msg:[],rMsg:[]},a=function(e,t){o.default.emit("edit",e),(0,i.addUndo)(e,t)};t.sendOutMsgWithoutDealUndoRedo=function(e){o.default.emit("edit",e)},t.sendMsg=function(e){for(var t,n,r=[],o=[],i=0;i<e.length;i++)t=e[i].msg,n=e[i].rMsg,r.push(t),o.push(n);!function(e){if("insert"===e[0].type)return!0}(r)?a(r,o):function(e,t){var n,r,o=e[0];l.msg.length?(n=o,r=l.msg[0],n.idx===r.idx+r.len&&(r.len+=n.len,r.cnt+=n.cnt)):(l.msg=e,l.rMsg=t,setTimeout((function(){a(l.msg,l.rMsg),l={msg:[],rMsg:[]}}),5e3))}(r,o)},t.createInsertTextActPair=function(e,t,n){return{act:c(e,t,n),rAct:u(e,t,n)}};var c=function(e,t,n){return{idx:e,len:t,type:"insert",cnt:n}},u=function(e,t,n){return{idx:e,len:t,type:"delete",cnt:n}}},579:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.receiveMessage=void 0,t.receiveMessage=function(e,t){return n(e,t)};var n=function(e,t){var n="";return"insert"===e.type?n=t.slice(0,e.idx)+e.cnt+t.slice(e.idx):"delete"===e.type&&(n=t.slice(0,e.idx)+t.slice(e.idx+e.len)),n}},3085:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=(0,n(2096).io)("http://localhost:4000");t.default=r},9030:(e,t,n)=>{var r=n(7671),o=n(9471),i=n(2866),l=n(8219);t.A=function(){var e=(0,o.useState)([]),t=e[0],n=e[1],a=(0,o.useRef)(null),c=(0,o.useRef)(null),u=(0,i.useHistory)();(0,o.useEffect)((function(){l.http.get("/file/myList").then((function(e){console.log("res:",e),console.log("document.cookie:",document.cookie),200===e.data.code?n(e.data.data):u.replace("/login")})).catch((function(e){console.log("err:",e)}))}),[]);var s=function(){window.open("/fileEdit")},d=function(e){var t,n;e?null===(t=null==c?void 0:c.current)||void 0===t||t.click():null===(n=null==a?void 0:a.current)||void 0===n||n.click()};return(0,r.jsxs)("div",{children:[(0,r.jsx)("button",{onClick:function(){fetch("http://localhost:3000/file/image.jpg",{headers:{}}).then((function(e){console.log("图片请求：",e)}))},children:"发送一个静态文件请求"}),(0,r.jsx)("button",{onClick:function(){l.http.get("/file/myList").then((function(e){console.log("res:",e)})).catch((function(e){console.log("err:",e)}))},children:"fileList请求"}),(0,r.jsx)("button",{onClick:function(e){console.log("event:",e),l.http.post("/file/addFile").then((function(e){console.log("res:",e)})).catch((function(e){console.log("err:",e)}))},children:"新建一个文件"}),(0,r.jsx)("button",{onClick:function(){d(!1)},children:"上传一个文件"}),(0,r.jsx)("button",{onClick:function(){d(!0)},children:"分片上传一个文件"}),(0,r.jsx)("input",{type:"file",ref:a,onChange:function(e){var t,n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&function(e){var t=new FormData;t.append("file",e),console.log("开始上传文档：",new Date),l.http.post("/file/upload",t).then((function(e){console.log("文件上传的结果res:",e),console.log("文档上传结束：",new Date)})).catch((function(e){console.log("文件上传的结果err:",e)}))}(n)}}),(0,r.jsx)("input",{type:"file",ref:c,onChange:function(e){var t,n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&function(e){console.log("开始分片上传文档：",new Date);for(var t=419430400,n=Math.ceil(e.size/t),r=[],o=function(t,n,r){var o=new FormData;return o.append("file",t,e.name),o.append("chunkNumber",n),o.append("totalChunks",r),l.http.post("/file/upload2",o)},i=0;i<e.size;i+=t){var a=Math.min(i+t,e.size),c=e.slice(i,a),u=i/t+1;r.push(o(c,u.toString(),n.toString()))}Promise.all(r).then((function(e){console.log("文件分片上传的结果：",e),console.log("文档分片上传结束：",new Date)}))}(n)}}),t.map((function(e){return(0,r.jsx)("div",{onClick:s,children:e.title},e.docId)}))]})}},5047:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.undo=t.addUndo=void 0;var r=n(8094),o=n(579),i=[],l=0;t.undo=function(e){var t=i[l];l--;var n=t.undo,a=(0,o.receiveMessage)(n[0],e);return(0,r.sendOutMsgWithoutDealUndoRedo)(n),a},t.addUndo=function(e,t){var n={undo:[],redo:[]};n.undo=t,n.redo=e,i.push(n),l=i.length-1}},8219:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.http=void 0;var o=r(n(6425)).default.create({baseURL:"http://localhost:3000",withCredentials:!0});t.http=o,o.interceptors.request.use((function(e){return console.log("config:",e),e.headers.setAuthorization(document.cookie),e}),(function(e){return Promise.reject(e)}))}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var i=n[e]={id:e,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.exports}r.m=t,e=[],r.O=(t,n,o,i)=>{if(!n){var l=1/0;for(s=0;s<e.length;s++){for(var[n,o,i]=e[s],a=!0,c=0;c<n.length;c++)(!1&i||l>=i)&&Object.keys(r.O).every((e=>r.O[e](n[c])))?n.splice(c--,1):(a=!1,i<l&&(l=i));if(a){e.splice(s--,1);var u=o();void 0!==u&&(t=u)}}return t}i=i||0;for(var s=e.length;s>0&&e[s-1][2]>i;s--)e[s]=e[s-1];e[s]=[n,o,i]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var o,i,[l,a,c]=n,u=0;if(l.some((t=>0!==e[t]))){for(o in a)r.o(a,o)&&(r.m[o]=a[o]);if(c)var s=c(r)}for(t&&t(n);u<l.length;u++)i=l[u],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return r.O(s)},n=self.webpackChunkmyreactapp=self.webpackChunkmyreactapp||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),r.nc=void 0;var o=r.O(void 0,[377],(()=>r(3742)));o=r.O(o)})();
//# sourceMappingURL=main.8714d36ce5.js.map