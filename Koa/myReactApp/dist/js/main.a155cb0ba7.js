(()=>{"use strict";var e,n={4822:(e,n,t)=>{var o=t(9471),r=t(2866),i=t(2820),l=t(9027),c=t(9030),u=t(7984),a=t.n(u),s=t(3085),d=t(8094),f=t(579),p=t(5047),h=t(5072),g=t.n(h),v=t(7825),m=t.n(v),b=t(7659),x=t.n(b),y=t(5056),A=t.n(y),j=t(540),M=t.n(j),w=t(1113),C=t.n(w),k=t(8995),O={};function E(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=Array(n);t<n;t++)o[t]=e[t];return o}O.styleTagTransform=C(),O.setAttributes=A(),O.insert=x().bind(null,"head"),O.domAPI=m(),O.insertStyleElement=M(),g()(k.A,O),k.A&&k.A.locals&&k.A.locals;const T=function(){var e,n,t,r=(0,o.useRef)(null),i=(n=(0,o.useState)([]),t=2,function(e){if(Array.isArray(e))return e}(n)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var o,r,i,l,c=[],u=!0,a=!1;try{if(i=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;u=!1}else for(;!(u=(o=i.call(t)).done)&&(c.push(o.value),c.length!==n);u=!0);}catch(e){a=!0,r=e}finally{try{if(!u&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(a)throw r}}return c}}(n,t)||function(e,n){if(e){if("string"==typeof e)return E(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?E(e,n):void 0}}(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=(i[0],i[1],(null==r||null===(e=r.current)||void 0===e?void 0:e.innerHTML)||""),c=new(a());(0,o.useEffect)((function(){s.default.on("connect",(function(){console.log("client connect",s.default.id)})),s.default.on("edit",(function(e){r.current.innerHTML=(0,f.receiveMessage)(e[0],r.current.innerHTML)}))}));var u=function(e){var n=0;console.log("caretOffset:",n);var t=e.target.ownerDocument.defaultView.getSelection();return t.rangeCount&&(t.getRangeAt(0),n=t.focusOffset),n};return o.createElement("div",null,"查看文件",o.createElement("button",{onClick:function(){r.current.innerHTML=(0,p.undo)(r.current.innerHTML)}},"undo"),o.createElement("div",{contentEditable:!0,onInput:function(e){console.log("编辑了，需要发消息出去:",e.target.innerHTML);var n=c.diff_main(l,e.target.innerHTML);l=e.target.innerHTML;var t=(0,d.createInsertTextActPair)(u(e)-1,1,n[n.length-1][1]),o={msg:t.act,rMsg:t.rAct};(0,d.sendMsg)([o])},className:"editor",ref:r,onMouseUp:u}))},_=function(){return o.createElement(r.BrowserRouter,null,o.createElement(i.dO,null,o.createElement(i.qh,{path:"/",component:l.A}),o.createElement(i.qh,{path:"/fileList",component:c.A}),o.createElement(i.qh,{path:"/fileEdit",component:T})))};t(4723).createRoot(document.getElementById("root")).render(o.createElement(_,null))},8995:(e,n,t)=>{t.d(n,{A:()=>c});var o=t(963),r=t.n(o),i=t(9089),l=t.n(i)()(r());l.push([e.id,"/* 需要在webpack中配置css相关的loader */\n.editor {\n  border: 1px solid red;\n  padding: 10px;\n  height: 400px;\n  width: 400px;\n  /* min-height: 200px; */\n  margin-top: 10px;\n}\n","",{version:3,sources:["webpack://./src/pages/FileEdit/index.css"],names:[],mappings:"AAAA,8BAA8B;AAC9B;EACE,qBAAqB;EACrB,aAAa;EACb,aAAa;EACb,YAAY;EACZ,uBAAuB;EACvB,gBAAgB;AAClB",sourcesContent:["/* 需要在webpack中配置css相关的loader */\r\n.editor {\r\n  border: 1px solid red;\r\n  padding: 10px;\r\n  height: 400px;\r\n  width: 400px;\r\n  /* min-height: 200px; */\r\n  margin-top: 10px;\r\n}\r\n"],sourceRoot:""}]);const c=l},8094:function(e,n,t){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.createInsertTextActPair=n.sendMsg=n.sendOutMsgWithoutDealUndoRedo=void 0;var r=o(t(3085)),i=t(5047),l={msg:[],rMsg:[]},c=function(e,n){r.default.emit("edit",e),(0,i.addUndo)(e,n)};n.sendOutMsgWithoutDealUndoRedo=function(e){r.default.emit("edit",e)},n.sendMsg=function(e){for(var n,t,o=[],r=[],i=0;i<e.length;i++)n=e[i].msg,t=e[i].rMsg,o.push(n),r.push(t);!function(e){if("insert"===e[0].type)return!0}(o)?c(o,r):function(e,n){var t,o,r=e[0];l.msg.length?(t=r,o=l.msg[0],t.idx===o.idx+o.len&&(o.len+=t.len,o.cnt+=t.cnt)):(l.msg=e,l.rMsg=n,setTimeout((function(){c(l.msg,l.rMsg),l={msg:[],rMsg:[]}}),5e3))}(o,r)},n.createInsertTextActPair=function(e,n,t){return{act:u(e,n,t),rAct:a(e,n,t)}};var u=function(e,n,t){return{idx:e,len:n,type:"insert",cnt:t}},a=function(e,n,t){return{idx:e,len:n,type:"delete",cnt:t}}},579:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.receiveMessage=void 0,n.receiveMessage=function(e,n){return t(e,n)};var t=function(e,n){var t="";return"insert"===e.type?t=n.slice(0,e.idx)+e.cnt+n.slice(e.idx):"delete"===e.type&&(t=n.slice(0,e.idx)+n.slice(e.idx+e.len)),t}},3085:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0});var o=(0,t(2096).io)("http://localhost:4000");n.default=o},9030:(e,n,t)=>{var o=t(7671),r=t(9471),i=t(2866),l=t(8219);n.A=function(){var e=(0,r.useState)([]),n=e[0],t=e[1],c=(0,r.useRef)(null),u=(0,r.useRef)(null),a=(0,i.useHistory)();(0,r.useEffect)((function(){l.http.get("/file/myList").then((function(e){console.log("res:",e),console.log("document.cookie:",document.cookie),200===e.data.code?t(e.data.data):a.replace("/login")})).catch((function(e){console.log("err:",e)}))}),[]);var s=function(){window.open("/fileEdit")},d=function(e){var n,t;e?null===(n=null==u?void 0:u.current)||void 0===n||n.click():null===(t=null==c?void 0:c.current)||void 0===t||t.click()};return(0,o.jsxs)("div",{children:[(0,o.jsx)("button",{onClick:function(){fetch("http://localhost:3000/file/image.jpg",{headers:{}}).then((function(e){console.log("图片请求：",e)}))},children:"发送一个静态文件请求"}),(0,o.jsx)("button",{onClick:function(){l.http.get("/file/myList").then((function(e){console.log("res:",e)})).catch((function(e){console.log("err:",e)}))},children:"fileList请求"}),(0,o.jsx)("button",{onClick:function(e){console.log("event:",e),l.http.post("/file/addFile").then((function(e){console.log("res:",e)})).catch((function(e){console.log("err:",e)}))},children:"新建一个文件"}),(0,o.jsx)("button",{onClick:function(){d(!1)},children:"上传一个文件"}),(0,o.jsx)("button",{onClick:function(){d(!0)},children:"分片上传一个文件"}),(0,o.jsx)("input",{type:"file",ref:c,onChange:function(e){var n,t=null===(n=e.target.files)||void 0===n?void 0:n[0];t&&function(e){var n=new FormData;n.append("file",e),console.log("开始上传文档：",new Date),l.http.post("/file/upload",n).then((function(e){console.log("文件上传的结果res:",e),console.log("文档上传结束：",new Date)})).catch((function(e){console.log("文件上传的结果err:",e)}))}(t)}}),(0,o.jsx)("input",{type:"file",ref:u,onChange:function(e){var n,t=null===(n=e.target.files)||void 0===n?void 0:n[0];t&&function(e){console.log("开始分片上传文档：",new Date);for(var n=419430400,t=Math.ceil(e.size/n),o=[],r=function(n,t,o){var r=new FormData;return r.append("file",n,e.name),r.append("chunkNumber",t),r.append("totalChunks",o),l.http.post("/file/upload2",r)},i=0;i<e.size;i+=n){var c=Math.min(i+n,e.size),u=e.slice(i,c),a=i/n+1;o.push(r(u,a.toString(),t.toString()))}Promise.all(o).then((function(e){console.log("文件分片上传的结果：",e),console.log("文档分片上传结束：",new Date)}))}(t)}}),n.map((function(e){return(0,o.jsx)("div",{onClick:s,children:e.title},e.docId)}))]})}},9027:(e,n,t)=>{var o=t(7671),r=t(9471),i=t(9471),l=t(2866),c=t(8219);n.A=function(){var e=(0,i.useState)(""),n=e[0],t=e[1],u=(0,i.useState)(""),a=u[0],s=u[1],d=(0,i.useState)(0),f=d[0],p=d[1],h=(0,l.useHistory)(),g=-1,v=(0,r.useRef)(-1);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:"登录页面"}),(0,o.jsx)("label",{children:"用户名："}),(0,o.jsx)("input",{type:"text",value:n,onChange:function(e){t(e.target.value)}}),(0,o.jsx)("br",{}),(0,o.jsx)("label",{children:"密码："}),(0,o.jsx)("input",{type:"password",value:a,onChange:function(e){s(e.target.value)}}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:function(){c.http.post("/users/login",{username:n,pwd:a}).then((function(e){if(console.log(e),200==e.data.code){var n=e.data.token;document.cookie="".concat(n),h.replace("/fileList")}else alert("Invalid credentials")})).catch((function(e){console.log(e)}))},children:"登录"}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:function(){g=setTimeout((function(){console.log("开启了一个定时器")}),1e3)},children:"开启一个setTimeout定时器"}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:function(){console.log("关闭一个定时器"),clearTimeout(g)},children:"关闭一个setTimeout定时器"}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:function(){v.current=setInterval((function(){console.log(new Date)}),1e3)},children:"开启一个setInterval定时器"}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:function(){clearInterval(v.current)},children:"关闭一个setInterval定时器"}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:function(){p(f+1)},children:"count++"}),(0,o.jsxs)("div",{children:["count: ",f]})]})}},5047:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.undo=n.addUndo=void 0;var o=t(8094),r=t(579),i=[],l=0;n.undo=function(e){var n=i[l];l--;var t=n.undo,c=(0,r.receiveMessage)(t[0],e);return(0,o.sendOutMsgWithoutDealUndoRedo)(t),c},n.addUndo=function(e,n){var t={undo:[],redo:[]};t.undo=n,t.redo=e,i.push(t),l=i.length-1}},8219:function(e,n,t){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.http=void 0;var r=o(t(6425)).default.create({baseURL:"http://localhost:3000",withCredentials:!0});n.http=r,r.interceptors.request.use((function(e){return console.log("config:",e),e.headers.setAuthorization(document.cookie),e}),(function(e){return Promise.reject(e)}))}},t={};function o(e){var r=t[e];if(void 0!==r)return r.exports;var i=t[e]={id:e,exports:{}};return n[e].call(i.exports,i,i.exports,o),i.exports}o.m=n,e=[],o.O=(n,t,r,i)=>{if(!t){var l=1/0;for(s=0;s<e.length;s++){for(var[t,r,i]=e[s],c=!0,u=0;u<t.length;u++)(!1&i||l>=i)&&Object.keys(o.O).every((e=>o.O[e](t[u])))?t.splice(u--,1):(c=!1,i<l&&(l=i));if(c){e.splice(s--,1);var a=r();void 0!==a&&(n=a)}}return n}i=i||0;for(var s=e.length;s>0&&e[s-1][2]>i;s--)e[s]=e[s-1];e[s]=[t,r,i]},o.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return o.d(n,{a:n}),n},o.d=(e,n)=>{for(var t in n)o.o(n,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};o.O.j=n=>0===e[n];var n=(n,t)=>{var r,i,[l,c,u]=t,a=0;if(l.some((n=>0!==e[n]))){for(r in c)o.o(c,r)&&(o.m[r]=c[r]);if(u)var s=u(o)}for(n&&n(t);a<l.length;a++)i=l[a],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(s)},t=self.webpackChunkmyreactapp=self.webpackChunkmyreactapp||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})(),o.nc=void 0;var r=o.O(void 0,[377],(()=>o(4822)));r=o.O(r)})();
//# sourceMappingURL=main.a155cb0ba7.js.map