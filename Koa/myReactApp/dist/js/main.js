(()=>{"use strict";var e,t={5314:(e,t,n)=>{var o=n(9471),r=n(2866),i=n(2820),l=n(9027),c=n(9030),u=n(7984),a=n.n(u),s=n(3085),d=n(8094),f=n(579),h=n(5047),v=n(4346),p=n.n(v);function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}const m=function(){var e,t,n,r=(0,o.useRef)(null),i=(t=(0,o.useState)([]),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,l,c=[],u=!0,a=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=i.call(n)).done)&&(c.push(o.value),c.length!==t);u=!0);}catch(e){a=!0,r=e}finally{try{if(!u&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(a)throw r}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return g(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=(i[0],i[1],(null==r||null===(e=r.current)||void 0===e?void 0:e.innerHTML)||""),c=new(a());(0,o.useEffect)((function(){s.default.on("connect",(function(){console.log("client connect",s.default.id)})),s.default.on("edit",(function(e){r.current.innerHTML=(0,f.receiveMessage)(e[0],r.current.innerHTML)}))}));var u=function(e){var t=0;console.log("caretOffset:",t);var n=e.target.ownerDocument.defaultView.getSelection();return n.rangeCount&&(n.getRangeAt(0),t=n.focusOffset),t};return o.createElement("div",null,o.createElement(p(),null),"查看文件",o.createElement("button",{onClick:function(){r.current.innerHTML=(0,h.undo)(r.current.innerHTML)}},"undo"),o.createElement("div",{contentEditable:!0,onInput:function(e){console.log("编辑了，需要发消息出去:",e.target.innerHTML);var t=c.diff_main(l,e.target.innerHTML);l=e.target.innerHTML;var n=(0,d.createInsertTextActPair)(u(e)-1,1,t[t.length-1][1]),o={msg:n.act,rMsg:n.rAct};(0,d.sendMsg)([o])},className:"editor",ref:r,onMouseUp:u}),"假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容 假装有很多内容假装有很多内容 假装有很多内容")},b=function(){return o.createElement(r.BrowserRouter,null,o.createElement(i.qh,{path:"/login",component:l.A}),o.createElement(i.qh,{path:"/fileList",component:c.A}),o.createElement(i.qh,{path:"/fileEdit",component:m}))};n(4723).createRoot(document.getElementById("root")).render(o.createElement(b,null))},117:(e,t,n)=>{n.r(t)},8436:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});var o=n(7671),r=n(9471);n(117),t.default=function(e){var t=e.title,n=void 0===t?"默认标题":t,i=e.isOpen,l=void 0!==i&&i,c=e.onClose,u=void 0===c?function(){}:c,a=e.children,s=void 0===a?(0,o.jsx)(o.Fragment,{}):a,d=e.style;return console.log("child:",s),console.log("isOpen:",l),(0,r.useEffect)((function(){document.body.style.overflow=l?"hidden":""}),[l]),l?(0,o.jsx)("div",{className:"modal-backdrop",children:(0,o.jsxs)("div",{className:"modal-content",style:d,children:[(0,o.jsxs)("div",{className:"model-header",children:[(0,o.jsx)("h3",{children:n}),(0,o.jsx)("button",{onClick:u,children:"关闭图标"})]}),(0,o.jsx)("div",{className:"model-body",children:s}),(0,o.jsx)("div",{className:"model-footer"})]})}):null}},4346:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=(0,i.useState)(!1),t=e[0],n=e[1],o=(0,i.useState)("默认标题"),c=o[0],u=o[1],a=(0,i.useState)({}),s=a[0],d=a[1];return(0,r.jsxs)("div",{children:["里面有很多按钮",(0,r.jsx)("button",{onClick:function(){n(!0),u("插入超链接")},children:"插入超链接"}),(0,r.jsx)("button",{onClick:function(){n(!0),u("页面设置")},children:"页面设置"}),(0,r.jsx)("button",{onClick:function(){n(!0),u("查找替换"),d({backgroundColor:"red",top:"40px",position:"absolute"})},children:"查找替换"}),(0,r.jsx)(l.default,{isOpen:t,title:c,onClose:function(){n(!1),u(""),d({})},style:s,children:(0,r.jsx)("div",{children:"内部内容"})})]})};var r=n(7671),i=n(9471),l=o(n(8436))},8094:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createInsertTextActPair=t.sendMsg=t.sendOutMsgWithoutDealUndoRedo=void 0;var r=o(n(3085)),i=n(5047),l={msg:[],rMsg:[]},c=function(e,t){r.default.emit("edit",e),(0,i.addUndo)(e,t)};t.sendOutMsgWithoutDealUndoRedo=function(e){r.default.emit("edit",e)},t.sendMsg=function(e){for(var t,n,o=[],r=[],i=0;i<e.length;i++)t=e[i].msg,n=e[i].rMsg,o.push(t),r.push(n);!function(e){if("insert"===e[0].type)return!0}(o)?c(o,r):function(e,t){var n,o,r=e[0];l.msg.length?(n=r,o=l.msg[0],n.idx===o.idx+o.len&&(o.len+=n.len,o.cnt+=n.cnt)):(l.msg=e,l.rMsg=t,setTimeout((function(){c(l.msg,l.rMsg),l={msg:[],rMsg:[]}}),5e3))}(o,r)},t.createInsertTextActPair=function(e,t,n){return{act:u(e,t,n),rAct:a(e,t,n)}};var u=function(e,t,n){return{idx:e,len:t,type:"insert",cnt:n}},a=function(e,t,n){return{idx:e,len:t,type:"delete",cnt:n}}},579:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.receiveMessage=void 0,t.receiveMessage=function(e,t){return n(e,t)};var n=function(e,t){var n="";return"insert"===e.type?n=t.slice(0,e.idx)+e.cnt+t.slice(e.idx):"delete"===e.type&&(n=t.slice(0,e.idx)+t.slice(e.idx+e.len)),n}},3085:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});var o=(0,n(2096).io)("http://localhost:4000");t.default=o},9030:(e,t,n)=>{var o=n(7671),r=n(9471),i=n(2866),l=n(8219);t.A=function(){var e=(0,r.useState)([]),t=e[0],n=e[1],c=(0,r.useRef)(null),u=(0,r.useRef)(null),a=(0,i.useHistory)();(0,r.useEffect)((function(){l.http.get("/file/myList").then((function(e){console.log("res:",e),console.log("document.cookie:",document.cookie),200===e.data.code?n(e.data.data):a.replace("/login")})).catch((function(e){console.log("err:",e)}))}),[]);var s=function(){window.open("/fileEdit")},d=function(e){var t,n;e?null===(t=null==u?void 0:u.current)||void 0===t||t.click():null===(n=null==c?void 0:c.current)||void 0===n||n.click()};return(0,o.jsxs)("div",{children:[(0,o.jsx)("button",{onClick:function(){fetch("http://localhost:3000/file/image.jpg",{headers:{}}).then((function(e){console.log("图片请求：",e)}))},children:"发送一个静态文件请求"}),(0,o.jsx)("button",{onClick:function(){l.http.get("/file/myList").then((function(e){console.log("res:",e)})).catch((function(e){console.log("err:",e)}))},children:"fileList请求"}),(0,o.jsx)("button",{onClick:function(e){console.log("event:",e),l.http.post("/file/addFile").then((function(e){console.log("res:",e)})).catch((function(e){console.log("err:",e)}))},children:"新建一个文件"}),(0,o.jsx)("button",{onClick:function(){d(!1)},children:"上传一个文件"}),(0,o.jsx)("button",{onClick:function(){d(!0)},children:"分片上传一个文件"}),(0,o.jsx)("input",{type:"file",ref:c,onChange:function(e){var t,n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&function(e){var t=new FormData;t.append("file",e),console.log("开始上传文档：",new Date),l.http.post("/file/upload",t).then((function(e){console.log("文件上传的结果res:",e),console.log("文档上传结束：",new Date)})).catch((function(e){console.log("文件上传的结果err:",e)}))}(n)}}),(0,o.jsx)("input",{type:"file",ref:u,onChange:function(e){var t,n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&function(e){console.log("开始分片上传文档：",new Date);for(var t=419430400,n=Math.ceil(e.size/t),o=[],r=function(t,n,o,i){void 0===i&&(i=0);var c=new FormData;return c.append("file",t,e.name),c.append("chunkNumber",n),c.append("totalChunks",o),l.http.post("/file/upload2",c).catch((function(){if(i<3)return console.error("Chunk ".concat(n," upload failed. Retrying... Attempt ").concat(i+1)),r(t,n,o,i+1);throw console.error("Failed after ".concat(3," attempts")),new Error("文件上传超出了重新上传的最大次数")}))},i=0;i<e.size;i+=t){var c=Math.min(i+t,e.size),u=e.slice(i,c),a=i/t+1;o.push(r(u,a.toString(),n.toString()))}Promise.all(o).then((function(e){console.log("文件分片上传的结果：",e),console.log("文档分片上传结束：",new Date)})).catch((function(e){console.log("all err:",e)}))}(n)}}),t.map((function(e){return(0,o.jsx)("div",{onClick:s,children:e.title},e.docId)}))]})}},9027:(e,t,n)=>{var o=n(7671),r=n(9471),i=n(9471),l=n(2866),c=n(8219);t.A=function(){var e=(0,i.useState)(""),t=e[0],n=e[1],u=(0,i.useState)(""),a=u[0],s=u[1],d=(0,i.useState)(0),f=d[0],h=d[1],v=(0,l.useHistory)(),p=-1,g=(0,r.useRef)(-1);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:"登录页面"}),(0,o.jsx)("label",{children:"用户名："}),(0,o.jsx)("input",{type:"text",value:t,onChange:function(e){n(e.target.value)}}),(0,o.jsx)("br",{}),(0,o.jsx)("label",{children:"密码："}),(0,o.jsx)("input",{type:"password",value:a,onChange:function(e){s(e.target.value)}}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:function(){c.http.post("/users/login",{username:t,pwd:a}).then((function(e){if(console.log(e),200==e.data.code){var t=e.data.token;document.cookie="".concat(t),v.replace("/fileList")}else alert("Invalid credentials")})).catch((function(e){console.log(e)}))},children:"登录"}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:function(){p=setTimeout((function(){console.log("开启了一个定时器")}),1e3)},children:"开启一个setTimeout定时器"}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:function(){console.log("关闭一个定时器"),clearTimeout(p)},children:"关闭一个setTimeout定时器"}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:function(){g.current=setInterval((function(){console.log(new Date)}),1e3)},children:"开启一个setInterval定时器"}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:function(){clearInterval(g.current)},children:"关闭一个setInterval定时器"}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:function(){h(f+1)},children:"count++"}),(0,o.jsxs)("div",{children:["count: ",f]})]})}},5047:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.undo=t.addUndo=void 0;var o=n(8094),r=n(579),i=[],l=0;t.undo=function(e){var t=i[l];l--;var n=t.undo,c=(0,r.receiveMessage)(n[0],e);return(0,o.sendOutMsgWithoutDealUndoRedo)(n),c},t.addUndo=function(e,t){var n={undo:[],redo:[]};n.undo=t,n.redo=e,i.push(n),l=i.length-1}},8219:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.http=void 0;var r=o(n(6425)).default.create({baseURL:"http://localhost:3000",withCredentials:!0});t.http=r,r.interceptors.request.use((function(e){return console.log("config:",e),e.headers.setAuthorization(document.cookie),e}),(function(e){return Promise.reject(e)}))}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,o),i.exports}o.m=t,e=[],o.O=(t,n,r,i)=>{if(!n){var l=1/0;for(s=0;s<e.length;s++){for(var[n,r,i]=e[s],c=!0,u=0;u<n.length;u++)(!1&i||l>=i)&&Object.keys(o.O).every((e=>o.O[e](n[u])))?n.splice(u--,1):(c=!1,i<l&&(l=i));if(c){e.splice(s--,1);var a=r();void 0!==a&&(t=a)}}return t}i=i||0;for(var s=e.length;s>0&&e[s-1][2]>i;s--)e[s]=e[s-1];e[s]=[n,r,i]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var r,i,[l,c,u]=n,a=0;if(l.some((t=>0!==e[t]))){for(r in c)o.o(c,r)&&(o.m[r]=c[r]);if(u)var s=u(o)}for(t&&t(n);a<l.length;a++)i=l[a],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(s)},n=self.webpackChunkmyreactapp=self.webpackChunkmyreactapp||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=o.O(void 0,[80],(()=>o(5314)));r=o.O(r)})();
//# sourceMappingURL=main.js.map